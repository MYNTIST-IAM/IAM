# MYNTIST Survivability IAM System

An adaptive, self-healing identity and access management (IAM) system built on mathematical survivability rules.

## Overview

This system manages GitHub tokens, AI agents, and product connections through real-time scoring, auditing, and self-healing automation.

## Project Structure

```
IAM/
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ workflows/
â”‚       â””â”€â”€ alerts.yml          # GitHub Actions for automated alerts
â”œâ”€â”€ agents/
â”‚   â””â”€â”€ agent-ledger.yml        # Central registry of all AI/automated agents
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ survivability_scoring.py    # Scoring bot that calculates token health
â”‚   â”œâ”€â”€ detect_agents.py            # Detects agents from GitHub Actions workflows
â”‚   â”œâ”€â”€ validate_agents.py          # Validates agent-to-token relationships
â”‚   â””â”€â”€ fetch_github_members.py     # Fetches GitHub org members and updates ledger
â”œâ”€â”€ security/
â”‚   â””â”€â”€ token-ledger.yml        # Central registry of all tokens
â”œâ”€â”€ reports/                    # Generated by scoring bot
â”‚   â”œâ”€â”€ token_health.json
â”‚   â”œâ”€â”€ token_health_report.md
â”‚   â”œâ”€â”€ agent_health.json
â”‚   â””â”€â”€ agent_health_report.md
â”œâ”€â”€ .env_example               # Environment variables template
â”œâ”€â”€ .gitignore
â”œâ”€â”€ requirements.txt
â””â”€â”€ README.md
```

## Setup

### 1. Install Dependencies

```bash
pip install -r requirements.txt
```

### 2. Configure Environment Variables

Create a `.env` file based on `.env_example`:

```bash
cp .env_example .env
```

Edit `.env` and add your credentials:

```
ORG_NAME=MYNTIST-IAM
PAT_TOKEN=your_github_personal_access_token_here
```

**Note:** Make sure your GitHub PAT has the following scopes:
- `read:org` - To read organization membership
- `admin:org` - To read member roles (if you have admin access)

### 3. Fetch GitHub Members

Run the script to populate the token ledger with GitHub organization members:

```bash
python scripts/fetch_github_members.py
```

This will:
- Fetch all members from your GitHub organization
- Get their roles (admin/member)
- Create token entries with their GitHub user ID as the `token_id`
- Add metadata like `entity_type: 'user'`, `role`, and `state`

### 4. Detect Agents from GitHub Actions

Detect and register agents from GitHub Actions workflows:

```bash
python scripts/detect_agents.py
```

This will:
- Scan `.github/workflows/` directory for workflow files
- Extract permissions and interaction scopes from workflows
- Create agent entries linked to tokens
- Update `agents/agent-ledger.yml`

### 5. Run Survivability Scoring

Calculate health scores for all tokens and agents:

```bash
python scripts/survivability_scoring.py
```

This generates:
- `reports/token_health.json` - JSON format for programmatic access
- `reports/token_health_report.md` - Human-readable markdown report
- `reports/agent_health.json` - Agent health data in JSON format
- `reports/agent_health_report.md` - Agent health markdown report
- `reports/product_health.json` - Product health data (pre-calculated for dashboard)
- `reports/product_health_report.md` - Product health markdown report

**Note**: Product health is automatically calculated after token/agent scoring using the average of all linked dependency scores.

### 6. Detect Products from Repositories

Detect and register products from GitHub repositories:

```bash
python scripts/detect_products.py
```

This will:
- Fetch all repositories from your GitHub organization
- Create product entries for each repository
- Note: Products require manual linking to agents/tokens

### 7. Validate Agents and Products

Validate that all agents and products have valid associations:

```bash
python scripts/validate_agents.py
python scripts/validate_products.py
```

## Token Ledger Schema

Each token in `security/token-ledger.yml` contains:

| Field | Type | Description |
|-------|------|-------------|
| `token_id` | String | Unique identifier (GitHub user ID for users, custom for services) |
| `owner` | String | Username or system account owner |
| `scope` | String | GitHub scopes or API access levels |
| `usage` | String | Area of use (CI/CD, deployment, API access, etc.) |
| `issued_on` | Date | Creation date |
| `expiry` | Date | Expiration date |
| `last_used` | Date | Last activity timestamp |
| `audit_trail` | List | Commits, repos, or services using the token |
| `survivability_score` | Float | Calculated by scoring bot (0â€“1) |
| `entity_type` | String | `'user'` for GitHub users, `'service_account'` for services |
| `role` | String | GitHub role (admin/member) or service role |
| `state` | String | Status (active/pending/inactive) |

## Survivability Scoring Formula

The system uses a mathematical model to calculate token health:

```
S = (1 / Q_perms) Ã— cos(scope_drift) Ã— audit_memory
```

Where:
- **Q_perms** = granted_permissions / used_permissions
- **scope_drift** = difference in scope vs. last version
- **audit_memory** = 1 if token has full audit trail, else <1

### Health Status

- **Healthy**: S â‰¥ 0.8
- **Degrading**: 0.5 â‰¤ S < 0.8
- **Critical**: S < 0.5

## Automated Workflows

The system includes GitHub Actions workflows that:
- Run nightly scoring automatically
- Send alerts for degrading tokens
- Trigger auto-healing mechanisms for critical tokens

### Auto-Heal System

The auto-heal system automatically proposes and applies remediations for at-risk tokens:

- **Detection**: `autoheal_detect.yml` runs every 6 hours, identifies candidates, and creates PRs
- **Review**: PRs include manifests under `ops/autoheal/` for human approval
- **Enforcement**: `autoheal_apply.yml` applies approved changes via GitHub API on PR merge

**Documentation**:
- ðŸ“š [`DOCS_INDEX.md`](DOCS_INDEX.md) - **Quick navigation to all documentation**
- [`README_AUTOHEAL.md`](README_AUTOHEAL.md) - Local testing guide
- [`ENFORCEMENT_GUIDE.md`](ENFORCEMENT_GUIDE.md) - âš ï¸ **Read this before merging auto-heal PRs** - Explains enforcement, shortcomings, and GitHub App migration
- [`QUICK_REFERENCE.md`](QUICK_REFERENCE.md) - Quick operations guide and emergencies

## Agent Ledger (Phase 2)

The system now tracks AI/automated agents that interact with repositories or APIs:

- **File**: `agents/agent-ledger.yml`
- **Detection**: Automatically detected from GitHub Actions workflows
- **Scoring**: Uses the same survivability scoring mechanism as tokens
- **Validation**: Every agent must be linked to one token

For detailed information, see [`AGENT_LEDGER.md`](AGENT_LEDGER.md).

## Product Ledger (Phase 3)

The system tracks products (apps, APIs, assets) and maps them to agents and tokens:

- **File**: `products/product-ledger.yml`
- **Registration**: Both manual and automatic (from GitHub repositories)
- **Health Calculation**: Aggregate health from linked tokens and agents (average)
- **Status**: Green/Yellow/Red based on aggregate health score

For detailed information, see [`PRODUCT_LEDGER.md`](PRODUCT_LEDGER.md).

## Next Steps

1. âœ… **Phase 2**: Auto-heal mechanisms implemented (token rotation, scope reduction)
2. âœ… **Phase 2**: Agent ledger for AI agents
3. âœ… **Phase 3**: Product ledger with aggregate health calculation
4. ðŸ”„ **Phase 2.5**: Migrate to GitHub App for secure enforcement (see [`ENFORCEMENT_GUIDE.md`](ENFORCEMENT_GUIDE.md))
5. **Phase 3**: Enable agent auto-heal detection (currently commented out)
6. **Phase 4**: Build React dashboard for visualization (in progress)
7. **Phase 5**: Add Slack/Teams notifications

## Security Notes

- Never commit `.env` file (it's in `.gitignore`)
- Token IDs are stored, but actual token values should never be in the ledger
- All sensitive operations should use GitHub Secrets in CI/CD

